<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCience</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;500;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }
        p {
            font-weight: 500;
        }
        header {
            background: grey;
            color: white;
            padding: 4rem 0;
            min-height: 100px;
            display: flex;
            align-items: flex-start; 
            padding-top: 0.1rem;
        }
        .header-container {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .logo-group {
            display: flex;
            align-items: flex-end;
            position: relative;
            height: 150px;
        }
        .main-letters {
            display: flex;
            align-items: flex-start;
        }
        .letter-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .science-letter {
            font-weight: 900;
            font-size: 9rem;
            color: #b80000;
            line-height: 0.7;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
        }
        .science-ience {
            font-weight: 600;
            font-size: 6rem; 
            color: black;
            line-height: 0.7;
        }
        .subscript {
            font-weight: 100;
            font-size: 1.8rem;
            color: #b80000;
            position: absolute;
            bottom: -2.5rem;
            white-space: nowrap;
        }
        .mart {
            left: 0;
        }
        .ities {
            right: 0;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        footer {
            background: black;
            color: white;
            padding: 1.5rem;
            margin-top: auto;
        }
        .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .chat-header {
            font-weight: 600;
            background-color: #202123;
            color: #fff;
            padding: 15px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            text-align: center;
            font-size: 18px;
        }
        .chat-history {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            border-bottom: 1px solid #e5e5e5;
        }
        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }
        .message.user {
            align-items: flex-end;
        }
        .message.bot {
            align-items: flex-start;
        }
        .message-text {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 10px;
            word-wrap: break-word;
            font-size: 14px;
        }
        .message.user .message-text {
            background-color: #007bff;
            color: #fff;
        }
        .message.bot .message-text {
            background-color: #e5e5e5;
            color: #000;
        }
.chat-input-container {
            display: flex;
            padding: 15px;
            gap: 8px;
            border-top: 1px solid #e5e5e5;
        }
        .chat-input {
            flex: 1;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #e5e5e5;
            border-radius: 5px;
            outline: none;
        }
        .chat-input:focus {
            border-color: #007bff;
        }
        .send-button {
            padding: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 16px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

.loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
            margin: 5px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .science-letter, .science-ience {
                font-size: 6rem;
            }
            
            .subscript {
                font-size: 1.5rem; 
                bottom: -2.5rem; 
            }
            
            .logo-group {
                height: 120px;
            }
            .chat-container {
                width: 300px;
                height: 400px;
                right: 10px;
                bottom: 10px;
            }
        }
        @media (max-width: 480px) {
            .science-letter, .science-ience {
                font-size: 4.5rem; 
            }
            .subscript {
                font-size: 1.2rem; 
                bottom: -2.5rem;
            }
            .logo-group {
                height: 90px;
            }
            .chat-container {
                width: 100%;
                height: 60vh;
                right: 0;
                bottom: 0;
                border-radius: 0;
            }
        }
        model-viewer {
            width: 250px; 
            height: 250px; 
            margin-left: 1px;
        }
    </style>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-container">
                <div class="logo-group">
                    <div class="main-letters">
                        <div class="letter-container">
                            <div class="science-letter">S</div>
                            <div class="subscript mart">mart</div>
                        </div>
                        <div class="letter-container">
                            <div class="science-letter">C</div>
                            <div class="subscript ities">ities'</div>
                        </div>
                    </div>
                    <div class="science-ience">ience</div>
                    <model-viewer 
                        src="https://gitknu.github.io/ai_smart_test/3d_comp.glb" 
                        alt="A 3D model" 
                        auto-rotate 
                        camera-controls
                        disable-zoom
                        style="width: 150px; height: 150px;">
                    </model-viewer>
                </div>
            </div>
        </div>
    </header>
    <main>
        <div class="container">
            <p class="description">
                Це короткий опис діяльності нашої групи з проєкту «Теоретичне і прикладне забезпечення розвитку смарт-інфраструктури розумних міст в період війни та післявоєнного відновлення України з урахуванням досвіду держав-членів Європейського Союзу» (керівник д. юрид. наук, проф. Олег Заярний, секція 13 – Економічні перетворення, бізнес, адміністрування та право);
            </p>
        </div>
    </main>
    <footer>
        <div class="container">
            <p>&copy; 2024 Your Website. All rights reserved.</p>
        </div>
    </footer>
    <div class="chat-container">
        <div class="chat-header">
            АІ - чат
        </div>
        <div class="chat-history" id="chatHistory">
            <div class="message bot">
                <div class="message-text">Є питання, але не готові писати нам?</div>
            </div>
            <div class="message bot" id="initLoader" style="display: none;">
                <div class="message-text"><div class="loader"></div></div>
            </div>
        </div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="inputText" placeholder="Напишіть Ваш запит...">
            <button class="send-button" onclick="sendMessage()">➤</button>
        </div>
    </div>
<script>
    let pipe = null;
    const answers = [
        "Sorry, I don't know the answer on this question",
        "Our project ",
        "Програмування на JavaScript та Python",
        "Перепрошую, як не знаю відповідь на це питання",
        "A walk in the forest during autumn",
        "Сонячний день у Карпатах"
    ];

    async function initializeEmbeddings() {
        const initLoader = document.createElement('div');
        initLoader.classList.add('message', 'bot');
        initLoader.innerHTML = `<div class="message-text"><div class="loader"></div></div>`;
        document.getElementById('chatHistory').appendChild(initLoader);
        const loader = initLoader.querySelector('.loader');
        loader.style.display = 'inline-block';

        const { pipeline } = await import('https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0');
        pipe = await pipeline('feature-extraction', 'Xenova/paraphrase-multilingual-MiniLM-L12-v2', {
            quantized: true,
            backend: 'cpu',
        });

        initLoader.remove();
        addBotMessage("Можете уточнити в ШІ - асистента! 🧠");
    }

    async function getEmbedding(text) {
        const output = await pipe(text, { pooling: 'mean', normalize: true });
        return Array.from(output.data);
    }

    function cosineSimilarity(a, b) {
        const dot = a.reduce((sum, val, i) => sum + val * b[i], 0);
        const magA = Math.sqrt(a.reduce((sum, val) => sum + val * val, 0));
        const magB = Math.sqrt(b.reduce((sum, val) => sum + val * val, 0));
        return dot / (magA * magB);
    }

    async function findBestMatch(inputText) {
        if (!pipe) {
            alert('Embeddings still loading...');
            return;
        }

        const loader = document.createElement('div');
        loader.className = 'loader';
        const loadingMessage = document.createElement('div');
        loadingMessage.classList.add('message', 'bot');
        loadingMessage.innerHTML = `<div class="message-text"></div>`;
        loadingMessage.querySelector('.message-text').appendChild(loader);
        document.getElementById('chatHistory').appendChild(loadingMessage);
        loader.style.display = 'inline-block';

        try {
            const inputEmbedding = await getEmbedding(inputText);
            let bestScore = -1;
            let bestAnswer = '';
            for (const answer of answers) {
                const answerEmbedding = await getEmbedding(answer);
                const score = cosineSimilarity(inputEmbedding, answerEmbedding);

                if (score > bestScore) {
                    bestScore = score;
                    bestAnswer = answer;
                }
            }
            addBotMessage(`${bestAnswer}<!-- ${bestScore.toFixed(3)}-->`);
        } catch (error) {
            console.error(error);
            addBotMessage("Sorry, I encountered an error while processing your request.");
        } finally {
            loadingMessage.remove();
        }
    }

    function addUserMessage(text) {
        const chatHistory = document.getElementById('chatHistory');
        const message = document.createElement('div');
        message.classList.add('message', 'user');
        message.innerHTML = `<div class="message-text">${text}</div>`;
        chatHistory.appendChild(message);
        chatHistory.scrollTop = chatHistory.scrollHeight;
    }

    function addBotMessage(text) {
        const chatHistory = document.getElementById('chatHistory');
        const message = document.createElement('div');
        message.classList.add('message', 'bot');
        message.innerHTML = `<div class="message-text">${text}</div>`;
        chatHistory.appendChild(message);
        chatHistory.scrollTop = chatHistory.scrollHeight;
    }

    function sendMessage() {
        const inputText = document.getElementById('inputText').value.trim();
        if (!inputText) return;

        addUserMessage(inputText);
        document.getElementById('inputText').value = '';
        findBestMatch(inputText);
    }

    initializeEmbeddings();

    document.getElementById('inputText').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });
</script>
</body>
</html>
