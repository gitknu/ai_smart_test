<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCience</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;500;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }
        p {
            font-weight: 500;
        }
        .answer {
  flex-direction: column;
  margin-inline: 1vw;
  width: calc(100% - 2vw); 
  margin-top:5vh;
  margin-bottom:5vh;
        }
        .answer:nth-child(odd) {
  align-items: flex-start; /* Align odd elements to the left */
  text-align: left;
}
.answer:nth-child(even) {
  align-items: flex-end; /* Align even elements to the right */
  text-align: right;
}
.answer.centered {
  align-items: center;
  text-align: center;
}
model-viewer {
    max-width:150px;
    margin-left: 1px;
}
header {
    background: grey;
    color: white;
    padding: 7rem 0;
    height: 150px; /* Explicit height for the header */
    display: flex;
    align-items: center; /* Vertically center all content */
    justify-content: center; /* Horizontally center all content */
}
        .header-container {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
.logo-group {
    display: flex;
    align-items: center; /* Vertically center all children */
    position: relative;
    height: 100%; /* Take full height of the header */
}
        .main-letters {
            display: flex;
            align-items: flex-start;
        }
        .letter-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .science-letter {
            font-weight: 900;
            font-size: 9rem;
            color: #b80000;
            line-height: 0.7;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
        }
        .science-ience {
            font-weight: 600;
            font-size: 6rem; 
            color: black;
            line-height: 0.7;
        }
        .subscript {
            font-weight: 100;
            font-size: 1.8rem;
            color: #b80000;
            position: absolute;
            bottom: -2.5rem;
            white-space: nowrap;
        }
        .mart {
            left: 0;
        }
        .ities {
            right: 0;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        footer {
            background: black;
            color: white;
            padding: 1.5rem;
            margin-top: auto;
        }
        .close-chat-button {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            color: white;
            font-size: 50px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        .close-chat-button:hover {
            color: #ccc;
        }
        .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 500px;
            height: 500px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            display: none;
            flex-direction: column;
            z-index: 1000;
            transition: all 0.3s ease;
        }
.chat-toggle-button,
.contact-toggle-button {
    right: 20px;
    width: 70px;
    height: 70px;
    position: fixed;
    opacity: 0.9;
    background-color: #007bff;
    color: black;
    border-radius: 50%;
    text-align: center;
    box-shadow: 3px 3px 4px rgba(0, 0, 0, 0.3);
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.4s ease-in-out;
    border: none;
    cursor: pointer;
    z-index: 1001;
}
.chat-toggle-button:hover,
.contact-toggle-button:hover {
    width: 65px;
    height: 65px;
    box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    opacity: 1;
}
.chat-toggle-button {
    bottom: 20px;
}
.contact-toggle-button {
    bottom: 100px;
}
.button-icon {
    height: 45px;
    transition: all 0.4s ease-in-out;
    filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.2));
}
        .chat-header {
            font-weight: 600;
            background-color: #202123;
            color: #fff;
            padding: 15px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            text-align: center;
            font-size: 18px;
        }
        .chat-history {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            border-bottom: 1px solid #e5e5e5;
        }
        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }
        .message.user {
            align-items: flex-end;
        }
        .message.bot {
            align-items: flex-start;
        }
        .message-text {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 10px;
            word-wrap: break-word;
            font-size: 14px;
        }
        .message.user .message-text {
            background-color: #007bff;
            color: #fff;
        }
        .message.bot .message-text {
            background-color: #e5e5e5;
            color: #000;
        }
.chat-input-container {
            display: flex;
            padding: 15px;
            gap: 8px;
            border-top: 1px solid #e5e5e5;
        }
        .chat-input {
            flex: 1;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #e5e5e5;
            border-radius: 5px;
            outline: none;
        }
        .chat-input:focus {
            border-color: #007bff;
        }
        .send-button {
            padding: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 16px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
.loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
            margin: 5px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 768px) {
                        .chat-container {
                width: 300px;
                height: 400px;
                right: 10px;
                bottom: 10px;
            }
    .chat-toggle-button,
    .contact-toggle-button {
        width: 60px;
        height: 60px;
        right: 15px;
    }
    .contact-toggle-button {
        bottom: 90px;
    }
    .button-icon {
        height: 35px;
    }
            .science-letter, .science-ience {
                font-size: 6rem;
            }       
            .subscript {
                font-size: 1.5rem; 
                bottom: -2.5rem; 
            }
            .logo-group {
                height: 120px;
            }
            .chat-container {
                width: 80%;
                height: 50vh;
                left: 50%;
                transform: translateX(-50%);
                bottom: 20px;
                border-radius: 10px;
            }
        }
        @media (max-width: 480px) {
            .science-letter, .science-ience {
                font-size: 4.5rem; 
            }
            .subscript {
                font-size: 1.2rem; 
                bottom: -2.5rem;
            }
            .logo-group {
                height: 90px;
            }
            .chat-container {
                width: 80%;
                height: 50vh;
                left: 50%;
                transform: translateX(-50%);
                bottom: 20px;
                border-radius: 10px;
            }
                 .chat-toggle-button,
    .contact-toggle-button {
        width: 50px;
        height: 50px;
        right: 10px;
    }
    .contact-toggle-button {
        bottom: 80px;
    }
    .button-icon {
        height: 30px;
    }
}
    </style>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-container">
                <div class="logo-group">
                    <div class="main-letters">
                        <div class="letter-container">
                            <div class="science-letter">S</div>
                            <div class="subscript mart">mart</div>
                        </div>
                        <div class="letter-container">
                            <div class="science-letter">C</div>
                            <div class="subscript ities">ities'</div>
                        </div>
                    </div>
                    <div class="science-ience">ience</div>
                    <model-viewer 
                        src="https://gitknu.github.io/ai_smart_test/3d_comp.glb" 
                        alt="A 3D model" 
                        auto-rotate 
                        camera-controls
                        disable-zoom>
                    </model-viewer>
                </div>
            </div>
        </div>
    </header>
    <main>
        <div class="container">
            <p class="answer">
                Вітаємо на сторінці проєкту <b>«Теоретичне і прикладне забезпечення розвитку смарт-інфраструктури розумних міст в період війни та післявоєнного відновлення України з урахуванням досвіду держав-членів Європейського Союзу»</b> ( <i>керівник д. юрид. наук, проф. Олег Заярний, секція 13 – Економічні перетворення, бізнес, адміністрування та право</i> ).
            </p>
            <p class="answer">
                RIGHT Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras rhoncus odio nec dictum tincidunt. Phasellus congue efficitur sapien sed posuere. Aliquam erat volutpat. Phasellus ornare ligula id odio convallis, et molestie odio dapibus. Cras faucibus ex ut leo lacinia condimentum. Fusce dapibus diam sed lacus pellentesque semper. Aenean a mollis ac. 
                        </p>
            <p class="answer">
                LEFT Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras rhoncus odio nec dictum tincidunt. Phasellus congue efficitur sapien sed posuere. Aliquam erat volutpat. Phasellus ornare ligula id odio convallis, et molestie odio dapibus. Cras faucibus ex ut leo lacinia condimentum. Fusce dapibus diam sed lacus pellentesque semper. Aenean a mollis ac. 
                        </p>
            <p class="answer">
                RIGHT Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras rhoncus odio nec dictum tincidunt. Phasellus congue efficitur sapien sed posuere. Aliquam erat volutpat. Phasellus ornare ligula id odio convallis, et molestie odio dapibus. Cras faucibus ex ut leo lacinia condimentum. Fusce dapibus diam sed lacus pellentesque semper. Aenean a mollis ac. 
            </p>
        </div>
    </main>
    <footer>
        <div class="container">
            <p>&copy; 2024 Your Website. All rights reserved.</p>
        </div>
    </footer>
    <div class="chat-container">
        <div class="chat-header">
            АІ - чат
            <button class="close-chat-button">×</button>
        </div>
        <div class="chat-history" id="chatHistory">
            <div class="message bot">
                <div class="message-text">Є питання, а шукати не готові? 🔍<br>Можете запитати мене, ШІ! 🧠<br><br><b>Звертаю Вашу увагу:</b><br>Один запит - одне питання 📌<br>Інколи я можу помилятися 🧩<br><br>Але я буду радий допомогти!</div>
            </div>
        </div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="inputText" placeholder="Напишіть Ваш запит...">
            <button class="send-button" onclick="sendMessage()">➤</button>
        </div>
    </div>
    <a href="tel:+1234567890" class="contact-toggle-button">
    <svg class="button-icon" viewBox="0 0 24 24" fill="currentColor">
        <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
    </svg>
</a>
<button class="chat-toggle-button">
    <svg class="button-icon" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9.29 16.29 5.7 12.7a.9959.9959 0 0 1 0-1.41c.39-.39 1.02-.39 1.41 0L10 14.17l6.88-6.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-7.59 7.59c-.38.39-1.02.39-1.41 0z"/>
    </svg>
</button>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const staticAnswers = [
        "I'm sorry, I don't know...", 
        "Перепрошую, я не знаю...",
        "My work is based on embeddings...",
        "В основі моєї роботи лежать ембедінги..."
    ];
    answers = [
        ...staticAnswers,
        ...Array.from(document.querySelectorAll('.answer'))
            .map(el => el.textContent.trim())
            .filter(text => text)
    ];
});
let pipe = null, embeddingsLoading = false, animationInterval = null;
const initializeEmbeddings = async () => {
    embeddingsLoading = true;
    ({ pipeline } = await import('https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0'));
    pipe = await pipeline('feature-extraction', 'Xenova/paraphrase-multilingual-MiniLM-L12-v2', {
        quantized: true,
        backend: 'cpu',
    });
    embeddingsLoading = false;
    openChat();
};
const chatUI = {
    toggle: document.querySelector('.chat-toggle-button'),
    container: document.querySelector('.chat-container'),
    open: () => {
        chatUI.container.style.display = 'flex';
        chatUI.toggle.style.display = 'none';
    },
    close: () => {
        chatUI.container.style.display = 'none';
        chatUI.toggle.style.display = 'flex';
    }
};
const animateButton = {
    start: () => {
        const frames = ['.', '..', '...'];
        let currentFrame = 0;
        chatUI.toggle.innerHTML = frames[currentFrame];
        animationInterval = setInterval(() => {
            currentFrame = (currentFrame + 1) % frames.length;
            chatUI.toggle.textContent = frames[currentFrame];
        }, 500);
    },
    stop: () => {
        clearInterval(animationInterval);
        chatUI.toggle.innerHTML = `
            <svg class="button-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9.29 16.29 5.7 12.7a.9959.9959 0 0 1 0-1.41c.39-.39 1.02-.39 1.41 0L10 14.17l6.88-6.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-7.59 7.59c-.38.39-1.02.39-1.41 0z"/>
            </svg>`;
    }
};
chatUI.toggle.addEventListener('click', () => {
    if (!pipe && !embeddingsLoading) {
        animateButton.start();
        initializeEmbeddings().finally(animateButton.stop);
    } else if (pipe) chatUI.open();
});
document.querySelector('.close-chat-button').addEventListener('click', chatUI.close);
const messageHandler = {
    add: (text, isUser = true) => {
        const message = document.createElement('div');
        message.classList.add('message', isUser ? 'user' : 'bot');
        message.innerHTML = `<div class="message-text">${isUser ? text : ''}</div>`;
        document.getElementById('chatHistory').appendChild(message);
        
        if (!isUser) this.type(text, message);
        message.scrollIntoView({ behavior: 'smooth' });
    },
    
    type: (text, element, delay = 50) => {
        let index = 0;
        const interval = setInterval(() => {
            element.querySelector('.message-text').textContent += text[index++];
            if (index >= text.length) clearInterval(interval);
        }, delay);
    }
};

const similarityUtils = {
    cosine: (a, b) => {
        const dot = a.reduce((sum, val, i) => sum + val * b[i], 0);
        const magnitude = v => Math.sqrt(v.reduce((sum, val) => sum + val * val, 0));
        return dot / (magnitude(a) * magnitude(b));
    },
    
    getEmbedding: async text => {
        const output = await pipe(text, { pooling: 'mean', normalize: true });
        return Array.from(output.data);
    }
};

const matchFinder = {
    directMatch: text => {
        if (text.length >= 7 && /(.)\1{6}/.test(text)) return text.match(/(.)\1{6}/)[0];
        return answers.find(answer => answer.includes(text.slice(0, 7)));
    },
    
    embeddingMatch: async text => {
        const inputEmbedding = await similarityUtils.getEmbedding(text);
        return answers.reduce((best, answer) => {
            const score = similarityUtils.cosine(inputEmbedding, answer.embedding);
            return score > best.score ? { answer, score } : best;
        }, { answer: '', score: -1 }).answer;
    }
};
const sendMessage = async () => {
    const input = document.getElementById('inputText');
    const text = input.value.trim();
    if (!text) return;
    input.value = '';
    messageHandler.add(text, true);
    const directMatch = matchFinder.directMatch(text);
    if (directMatch) {
        await new Promise(r => setTimeout(r, Math.min((text.length/15)*1000, 3000)));
        return messageHandler.add(directMatch, false);
    }
    const loader = document.createElement('div');
    loader.className = 'loader';
    messageHandler.add(loader.outerHTML, false);
    
    try {
        const response = await matchFinder.embeddingMatch(text);
    } finally {
        document.querySelector('.bot:last-child .loader')?.remove();
    }
};
document.getElementById('inputText').addEventListener('keypress', e => e.key === 'Enter' && sendMessage());
window.addEventListener('scroll', () => {
    const scrollPos = window.pageYOffset || document.documentElement.scrollTop;
    document.querySelectorAll('.answer').forEach(el => {
        const { top, bottom } = el.getBoundingClientRect();
        const visible = top < window.innerHeight && bottom > 0.3 * window.innerHeight;
        el.style = `opacity:${visible ? 1 : 0}; transition:opacity 0.4s, transform 0.4s; transform:translateX(${visible ? 0 : '50px'})`;
    });
});
</script>
</body>
</html>
